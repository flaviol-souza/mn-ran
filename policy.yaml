detection_mode: kpi
interfaces: [s1-eth1, s1-eth2, s1-eth3, s1-eth4]  # [C2_host, C2_uav, VID_host, VID_uav]
#  - s1-eth1   # C2: HOST(root-eth0) <-> OVS
#  - s1-eth2   # C2: OVS <-> UAV (uav-eth0)
#  - s1-eth3   # VÍDEO: OVS -> HOST (root-eth1)
#  - s1-eth4   # VÍDEO: OVS -> UAV  (uav-eth1)
qos_init_profile: baseline   # ou "degraded" para iniciar já apertado
poll_seconds: 2
iface_c2: "s1-eth1" # porta OVS de referência para C2 (proxy de métricas on-line)
iface_video: "s1-eth3"

run_dir: "logs"                 # opcional; se vazio, usa UCV_RUN_DIR ou /tmp/runs/<ts>_controller
pcap_enable: true
video_export_jsonl_path: "logs"   # se vazio, cai em <run_dir>/controller_video_kpi.jsonl

#filtro unidirecional para amostrar apenas UAV -> HOST (uplink)
c2_src_ip: "10.0.0.2"     # IP do UAV (origem dos pacotes)
c2_dst_ip: "10.0.0.254"   # IP do HOST/QGC (destino dos pacotes)
video_src_ip: "10.1.0.2"
video_dst_ip: "10.1.0.254"

# Taxa esperada de mensagens C2/MAVLink (Hz) – determina o período T (=1000/f) em ms.
# Basilar: dimensionamento de controle de voo e C2 (ref. DO-362A / FAA TSO-C213a: metas de latência/continuidade dependem da aplicação/classe).
c2_expected_rate_hz: 50

kpi:
  #  - "interarrival": estima perda comparando amostras recebidas vs. esperadas na janela.
  #  - "mavlink_seq": (opcional) usa o campo de sequência MAVLink do dissector para perda “real”.
  # Basilar (métrica de perda): IETF RFC 2680 (one-way loss); se não houver timesync, usar estimativa por chegada.
  method: interarrival

  # Janela móvel de cálculo (ms). Basilar (métrica de variação de atraso): IETF RFC 3393 / RFC 5481 (PDV/IPDV em conjuntos de amostras).
  window_ms: 5000

  # Continuidade: considera “outage” quando o gap entre updates C2 ≥ K×T.
  # Ex.: 25×T em 50 Hz ≈ 500 ms. Basilar: EUROCONTROL (continuidade/transação dentro do tempo).
  continuity_gap_T_mult: 25.0

  # continuidade na janela (relato, e pode virar critério):
  continuity_min_uptime_pct: 99.5

  # export em JSONL para gráficos/relato.
  export_jsonl_path: logs/ucv_kpi.jsonl

  # Perda p95 (%) para entrar/sair de degradado – mantenha histerese.
  # Basilar: perda de pacote (RFC 2680) e continuidade de serviço (EUROCONTROL DLP metrics).
  # Limiares de jitter **derivados do período T** PDV/IPDV (RFC 3393/5481) e relacionar a T do controle em vez de fixos.
  enter:
    jitter_T_mult: 3.0        # Limiares de jitter = 3×T → comportamento conservador: com T=20 ms (50 Hz), p95≈60 ms
    loss_p95_pct: 1.0
    bitrate_floor_mbps: 1.0   # piso de goodput do VÍDEO; QoE de missão (não é norma IPPM)
    min_degraded_time_s: 2.0  # hold para evitar “flap”
  exit:
    jitter_T_mult: 2.0        # Limiares de jitter = 2×T → recupera quando PDV p95 cai abaixo de 40 ms
    loss_p95_pct: 0.5
    bitrate_floor_mbps: 2.0
    cooldown_s: 10.0          # tempo mínimo “bom” antes de voltar ao baseline

# perfis de filas (HTB): q0 = EF/C2, q1 = AF/Vídeo
qos_profiles:
  baseline:         # operação normal
    q0_min: 1000000     # 1 Mb/s
    q0_max: 4000000     # 4 Mb/s
    q1_min: 1000000     # 1 Mb/s
    q1_max: 60000000    # 60 Mb/s

  degraded:         # eventos esperados (congestão, rajadas moderadas)
    q0_min: 4000000     # 4 Mb/s
    q0_max: 8000000     # 8 Mb/s
    q1_min: 300000      # 0.3 Mb/s
    q1_max: 5000000     # 5 Mb/s

  emergency:        # eventos severos (outage parcial, perda/jitter extremos)
    q0_min: 6000000     # 6 Mb/s
    q0_max: 12000000    # 12 Mb/s
    q1_min: 0
    q1_max: 2000000     # 2 Mb/s
